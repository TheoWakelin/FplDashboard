<div class="players-page">
  <!-- Header Section -->
  <div class="page-header">
    <h1 class="page-title">Players</h1>
  </div>

  <!-- Filters Toolbar -->
  <div class="filters-toolbar">
    <div class="filters-section">
      <span class="section-label">
        <svg class="filter-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        Filters
      </span>
      <div class="filter-group">
        <app-players-filters (filterChange)="onFilterChange($event)"></app-players-filters>
      </div>
    </div>
    
    <div class="controls-section">
      <button class="column-toggle-btn" (click)="toggleColumnToggle()" [attr.aria-label]="'Customize visible columns'" [attr.aria-expanded]="showColumnToggle">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="8" y1="6" x2="21" y2="6"></line>
          <line x1="8" y1="12" x2="21" y2="12"></line>
          <line x1="8" y1="18" x2="21" y2="18"></line>
          <line x1="3" y1="6" x2="3.01" y2="6"></line>
          <line x1="3" y1="12" x2="3.01" y2="12"></line>
          <line x1="3" y1="18" x2="3.01" y2="18"></line>
        </svg>
        Customize Columns
      </button>
      @if (showColumnToggle) {
        <div class="column-toggle-dropdown" [ngStyle]="columnDropdownStyle">
          <div class="dropdown-header">Select Columns to Display</div>
          <div class="column-list">
            @for (header of columnsService.getHeaders(); track header.key) {
              <label class="column-item" [class.disabled]="header.sticky">
                <input 
                  type="checkbox" 
                  [checked]="header.visible !== false" 
                  (change)="columnsService.toggleColumn(header)"
                  [disabled]="header.sticky"
                  [attr.aria-label]="'Toggle ' + header.label + ' column'">
                <span>{{ header.label }}</span>
                @if (header.sticky) {
                  <span class="required-badge">Required</span>
                }
              </label>
            }
          </div>
          <button class="close-dropdown-btn" (click)="toggleColumnToggle()">Close</button>
        </div>
      }
    </div>
  </div>

  <!-- Table Container Card -->
  <div class="table-card">
    @if (loading) {
      <app-loading-spinner></app-loading-spinner>
    }
    @if (!loading) {
      <div class="table-wrapper">
        <app-orderable-table
          [headers]="columnsService.getVisibleHeaders()"
          [orderBy]="orderBy"
          [orderDir]="orderDir"
          (sort)="setOrder($event.column, $event.direction)">
          @for (player of players; track player.playerName) {
            <tr>
              @for (header of columnsService.getVisibleHeaders(); track header.key) {
                <td [ngClass]="columnsService.getCellClass(header, player)">
                  @if (header.pipe === 'position') {
                    {{ player.position | position }}
                  } @else if (header.pipe === 'cost') {
                    {{ player.cost | cost }}
                  } @else {
                    {{ columnsService.getColumnValue(player, header.key) }}{{ header.suffix || '' }}
                  }
                </td>
              }
            </tr>
          }
        </app-orderable-table>
      </div>

      <!-- Pagination -->
      <app-pagination
        [currentPage]="page"
        [totalPages]="totalPages"
        [disabled]="loading"
        (pageChange)="onPageChange($event)">
      </app-pagination>
    }
  </div>
</div>
